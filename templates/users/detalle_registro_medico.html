{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Detalle de Registro Médico{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white p-6 rounded-t-2xl shadow-lg border-b border-gray-200">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">
                        Detalle de Registro Médico
                    </h1>
                    <p class="text-gray-600 mt-2">
                        Paciente: {{ paciente.user.first_name }} {{ paciente.user.last_name }}
                    </p>
                    <p class="text-sm text-gray-500">
                        Registro #{{ registro.id }} - {{ tipo|title }}
                    </p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                        ✅ Acceso Registrado
                    </span>
                    <a href="{% url 'users:perfil_paciente' paciente.id %}"
                       class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-200">
                        ← Volver al Perfil
                    </a>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="bg-white p-6 rounded-b-2xl shadow-lg">
            {% if tipo == 'alergia' %}
                <!-- Detalles de Alergia -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Sustancia Alérgena</label>
                            <p class="mt-1 text-lg font-semibold text-red-800">{{ registro.sustancia }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Severidad</label>
                            <p class="mt-1">
                                <span class="px-2 py-1 rounded-full text-sm font-medium
                                    {% if registro.severidad == 'leve' %}bg-yellow-100 text-yellow-800{% endif %}
                                    {% if registro.severidad == 'moderada' %}bg-orange-100 text-orange-800{% endif %}
                                    {% if registro.severidad == 'grave' %}bg-red-100 text-red-800{% endif %}
                                    {% if registro.severidad == 'muy_grave' %}bg-red-200 text-red-900{% endif %}">
                                    {{ registro.get_severidad_display }}
                                </span>
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Diagnóstico</label>
                            <p class="mt-1 text-gray-900">{{ registro.fecha_diagnostico }}</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Descripción</label>
                        <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                            {{ registro.descripcion|default:"Sin descripción adicional" }}
                        </p>
                    </div>
                </div>

            {% elif tipo == 'condicion' %}
                <!-- Detalles de Condición Médica -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Código CIE-10</label>
                            <p class="mt-1 text-lg font-semibold text-yellow-800">{{ registro.codigo }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Estado</label>
                            <p class="mt-1">
                                <span class="px-2 py-1 rounded-full text-sm font-medium
                                    {% if registro.estado == 'activa' %}bg-red-100 text-red-800{% endif %}
                                    {% if registro.estado == 'controlada' %}bg-yellow-100 text-yellow-800{% endif %}
                                    {% if registro.estado == 'remision' %}bg-blue-100 text-blue-800{% endif %}
                                    {% if registro.estado == 'curada' %}bg-green-100 text-green-800{% endif %}">
                                    {{ registro.get_estado_display }}
                                </span>
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Diagnóstico</label>
                            <p class="mt-1 text-gray-900">{{ registro.fecha_diagnostico }}</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Descripción</label>
                        <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                            {{ registro.descripcion|default:"Sin descripción adicional" }}
                        </p>
                    </div>
                </div>

            {% elif tipo == 'tratamiento' %}
                <!-- Detalles de Tratamiento -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Medicamento</label>
                            <p class="mt-1 text-lg font-semibold text-green-800">
                                {% if registro.medicamento %}
                                    {{ registro.medicamento.nombre }} ({{ registro.medicamento.concentracion }})
                                {% else %}
                                    No especificado
                                {% endif %}
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Dosis</label>
                            <p class="mt-1 text-gray-900">{{ registro.dosis|default:"No especificada" }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Frecuencia</label>
                            <p class="mt-1 text-gray-900">{{ registro.frecuencia|default:"No especificada" }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Estado</label>
                            <p class="mt-1">
                                <span class="px-2 py-1 rounded-full text-sm font-medium
                                    {% if registro.activo %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                    {% if registro.activo %}Activo{% else %}Inactivo{% endif %}
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Inicio</label>
                            <p class="mt-1 text-gray-900">{{ registro.fecha_inicio }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Fin</label>
                            <p class="mt-1 text-gray-900">{{ registro.fecha_fin|default:"En curso" }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Observaciones</label>
                            <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                                {{ registro.observaciones|default:"Sin observaciones" }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700">Descripción del Tratamiento</label>
                    <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                        {{ registro.descripcion }}
                    </p>
                </div>

            {% elif tipo == 'prueba_laboratorio' %}
                <!-- Detalles de Prueba de Laboratorio -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre de la Prueba</label>
                            <p class="mt-1 text-lg font-semibold text-blue-800">{{ registro.nombre_prueba }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de Realización</label>
                            <p class="mt-1 text-gray-900">{{ registro.fecha_realizacion }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Profesional Responsable</label>
                            <p class="mt-1 text-gray-900">{{ registro.profesional.get_full_name }}</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Valores de Referencia</label>
                            <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                                {{ registro.valores_referencia|default:"No especificados" }}
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Observaciones</label>
                            <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                                {{ registro.observaciones|default:"Sin observaciones" }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700">Resultados</label>
                    <div class="mt-1 text-gray-700 bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500">
                        <pre class="whitespace-pre-wrap font-mono text-sm">{{ registro.resultados }}</pre>
                    </div>
                </div>

            {% elif tipo == 'cirugia' %}
                <!-- Detalles de Cirugía -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Nombre de la Cirugía</label>
                            <p class="mt-1 text-lg font-semibold text-pink-800">{{ registro.nombre_cirugia }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Fecha de la Cirugía</label>
                            <p class="mt-1 text-gray-900">{{ registro.fecha_cirugia }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Estado</label>
                            <p class="mt-1">
                                <span class="px-2 py-1 rounded-full text-sm font-medium
                                    {% if registro.estado == 'programada' %}bg-blue-100 text-blue-800{% endif %}
                                    {% if registro.estado == 'realizada' %}bg-green-100 text-green-800{% endif %}
                                    {% if registro.estado == 'cancelada' %}bg-red-100 text-red-800{% endif %}
                                    {% if registro.estado == 'postergada' %}bg-yellow-100 text-yellow-800{% endif %}">
                                    {{ registro.get_estado_display }}
                                </span>
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Profesional Responsable</label>
                            <p class="mt-1 text-gray-900">{{ registro.profesional.get_full_name }}</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Complicaciones</label>
                            <p class="mt-1 text-gray-700 bg-gray-50 p-3 rounded-lg">
                                {{ registro.complicaciones|default:"Sin complicaciones reportadas" }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700">Descripción de la Cirugía</label>
                    <p class="mt-1 text-gray-700 bg-gray-50 p-4 rounded-lg border-l-4 border-pink-500">
                        {{ registro.descripcion }}
                    </p>
                </div>
            {% endif %}

            <!-- Información de Blockchain -->
            <div class="mt-8 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Información de Blockchain</h3>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-purple-800 font-medium">Registro Hasheado y Verificado</p>
                            <p class="text-xs text-purple-600 mt-1">
                                Este registro médico está protegido por blockchain y cualquier acceso queda registrado.
                            </p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="bg-purple-200 text-purple-800 px-3 py-1 rounded-full text-xs font-medium">
                                🔒 Protegido
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
